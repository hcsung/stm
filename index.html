<!DOCTYPE html>
<html>

<head>
  <title>Simple Gantt Chart</title>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" />
</head>

<body>
  <style>
    body,
    html {
      padding: 15px;
      background: #222;
      color: #fff;
      font-family: sans-serif;
      font-size: 13px;
    }

    table {
      border-collapse: collapse;
      background: #333;
      table-layout: fixed;
    }

    th,
    td {
      border-bottom: solid 7px #222;
      text-align: left;
      vertical-align: middle;
      white-space: nowrap;
      color: #ddd;
    }

    th {
      background: #111;
      color: #eee;
    }

    th.header {
      padding: 6px 9px;
    }

    td {
      padding: 0 9px;
    }

    td.time {
      padding: 0;
      min-width: 11px;
      border-left: dotted 1px #222;
    }

    td.marked {
      background: #996;
    }

    span {
      vertical-align: middle;
    }
  </style>

  <h1>Simple Gantt Chart</h1>

  <table id="dashboard"></table>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

  <script>
    const support = [];

    const cate = {
      "Bug": "bug_report",
      "Feature": "grade",
      "Task": "task_alt",
    };

    const headers = [
      { "key": "cate", "name": "Cate." },
      { "key": "link", "name": "Jira ID" },
      { "key": "proj", "name": "Project" },
      { "key": "title", "name": "Title" },
    ];

    // id = Date.time() + uuid[:12]
    const jobs = [
      {
        "link": "JIRA-1234",
        "cate": "Task",
        "proj": "Banana",
        "title": "Kernel upstream for banana driver",
        "id": "170196456326777b962c40a58"
      },
      {
        "link": "JIRA-1235",
        "cate": "Feature",
        "proj": "Cherry",
        "title": "AI generated cherry animation on screen",
        "id": "1701964585951ea0ea0b778cd"
      },
      {
        "link": "JIRA-1236",
        "cate": "Bug",
        "proj": "Durian",
        "title": "The color of the durian logo is shifted after suspend/resume",
        "id": "17019645946997351daa70dca"
      },
    ];

    const days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

    const logs = [
      {
        "job": "170196456326777b962c40a58",
        "rec": {
          "mon": {
            "1": 1,
            "2": 1,
            "3": 1,
            "4": 0.5,
            "5": 0.5,
            "6": 1,
            "7": 1,
            "8": 1
          },
          "tue": {
            "1": 1,
            "2": 1,
            "3": 1,
            "4": 1,
            "5": 1,
            "6": 1,
            "7": 1,
            "8": 1
          },
          "tue": {
            "1": 0.5,
            "2": 0.5,
            "3": 0.5
          },
          "fri": {
            "1": 1,
            "2": 1,
            "3": 1,
          },
        }
      },
      {
        "job": "1701964585951ea0ea0b778cd",
        "rec": {
          "mon": {
            "4": 0.5,
            "5": 0.5
          },
          "tue": {
            "1": 0.5,
            "2": 0.5,
            "3": 0.5,
            "4": 1,
            "5": 1,
            "6": 1,
            "7": 1,
            "8": 1
          },
          "wed": {
            "1": 1,
            "2": 1,
            "3": 1,
            "4": 1,
            "5": 1,
            "6": 1,
            "7": 1,
            "8": 1
          },
          "thu": {
            "4": 0.5,
            "5": 1,
            "6": 1,
            "7": 1,
            "8": 1
          },
        }
      },
      {
        "job": "17019645946997351daa70dca",
        "rec": {
          "thu": {
            "1": 1,
            "2": 1,
            "3": 1,
            "4": 0.5,
          },
          "fri": {
            "4": 1,
            "5": 1,
            "6": 1,
            "7": 1,
            "8": 1
          },
        }
      }
    ];

    let table = $("#dashboard");
    let tr = table.append($("<tr>"));

    // headers
    headers.forEach(header => tr.append($("<th>")
      .addClass("header")
      .text(header["name"])));
    days.forEach(day => tr.append($("<th>")
      .attr("colspan", 9)
      .text(day)));

    // parse the log
    logs.forEach(function (log) {
      let job;

      jobs.forEach(function (j) {
        if (log["job"] == j["id"])
          job = j;
      });

      if (!job)
        return;

      let tr = table.append($("<tr>"));

      // append info
      headers.forEach(function (header) {

        let key = header["key"];
        let info = job[key];

        if (!info)
          return;

        if (key == "cate") {
          let span = $("<span>")
            .addClass("material-symbols-outlined")
            .text(cate[info]);
          tr.append($("<td>").append($("<center>").append(span)));
          return;
        }
        tr.append($("<td>").text(info));
      });

      // append records
      days.forEach(function (day) {
        let d = day.toLowerCase();
        let rec = log["rec"];

        for (let i = 1; i < 9; i++) {
          if (rec[d]) {
            let time = rec[d][i.toString()];
            if (time) {
              //time = time < 1 ? time.toString().substring(1) : time;
              tr.append($("<td>").addClass("time marked").text(" "));
              continue;
            }
          }
          tr.append($("<td>").addClass("time").text(" "));
        }
      });
    });

  </script>
</body>

</html>